<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Mogom</title>
    <link rel="stylesheet" type="text/css" href="css/slider.css">
    <link rel="stylesheet" type="text/css" href="css/chronicle.css">
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/latest/TweenMax.min.js"></script>
	
	<script>
		var slider;
		var slides = [];
		var currentSlide = -1;
		var prevSlide;
		var prevPrevSlide;
		var timeline;
		
		$(window).ready(function () {
			slider = document.getElementById("slider1");
			slides = [];
 			slides[0] = document.getElementById("slide1");
/*			slides[1] = document.getElementById("slide2");
			slides[2] = document.getElementById("slide3");
			slides[3] = document.getElementById("slide4");
			slides[4] = document.getElementById("slide5");
 */
			
			$.getJSON("slidersrv", function(data){
				console.log(data);
				for (i = 0; i < data.length; i++) {
					var div1 = document.createElement("div");
					div1.className = "slide";
					
					var img1 = document.createElement("img");
					img1.style.position = "absolute";
					img1.src = data[i].url;
					div1.appendChild(img1);
					
					var span1 = document.createElement("span");
					span1.className = "slideTitle";
					span1.innerText = data[i].name;
					div1.appendChild(span1);
					
					slider.appendChild(div1);
					
					slides[slides.length] = div1;
				}  

				TweenMax.to(slides[0], 0, {autoAlpha: 1});
				
				for (i = 1; i < slides.length; i++) {
					TweenMax.to(slides[i], 0, {autoAlpha: 0});
				}
				
				timeline = new TimelineMax({onComplete:goToNextSlide, paused:true});
				
				goToNextSlide();
				//$("#slide1").remove();
			});			
			
		});

		function goToNextSlide() {
			currentSlide++;
			
			if (currentSlide >= slides.length) {
				currentSlide = 1;
			}

			if (currentSlide - 1 >= 0) {
				prevSlide = currentSlide - 1;
			} else {
				prevSlide = currentSlide - 1 + slides.length;
			}

			if (currentSlide - 2 >= 0) {
				prevPrevSlide = currentSlide - 2;
			} else {
				prevPrevSlide = currentSlide - 2 + slides.length;
			}
			
			timeline.clear();
			timeline.add(TweenMax.set(slides[prevPrevSlide], {autoAlpha: 0}));
			timeline.add(TweenMax.set(slides[currentSlide].getElementsByTagName("span"), {height: 30}));
			timeline.add(TweenMax.to(slides[currentSlide], 1, {autoAlpha: 1}));
			timeline.add(TweenMax.to(slides[currentSlide], 1, {autoAlpha: 1}));
			timeline.add(TweenMax.to(slides[currentSlide].getElementsByTagName("span"), 0.5, {height: 0}));
			timeline.add(TweenMax.to(slides[currentSlide], 3.5, {autoAlpha: 1}));
			
			timeline.play(0);
			updateZindex();
		}

		function updateZindex(){
 			for (i = 0; i < slides.length; i++) {
 	 			slides[i].style.zIndex = -1;
			}
 			slides[currentSlide].style.zIndex = 2;
 			slides[prevSlide].style.zIndex = 1;
		}

	</script>
</head>
<body>
    <h1>Mogom!</h1>
    
	<div id="slider1" class="slider">
 		<div id=slide1 class="slide">
			<img style="position:absolute" src="slide1.jpg" />
		</div>
 	</div>
	
	<br />
	
	<div id="chronicle1" class="chronicle">
		<img src="https://img-fotki.yandex.ru/get/16181/185558581.0/0_115586_e7481914_S" />
		<br />
		<img src="https://img-fotki.yandex.ru/get/6815/185558581.0/0_100e71_db68fb50_S" />
	</div>
	
    <table>
      <tr>
      	<td><a href="photolist.jsp">Photo List</a></td>
      </tr>
      <tr>
      	<td><a href="game.html">Game</a></td>
      </tr>
      <tr>
      	<td><a href="gamedev.html">Game Dev</a></td>
      </tr>
      <tr>
        <td><a href="kaleoins_test">Kaleoins_test</a></td>
      </tr>
      <tr>
        <td><a href="guestbook">Guestbook</a></td>
      </tr>
    </table>
  </body>
</html>
